{% extends 'base.html.twig' %}

{% block title %}Product{% endblock %}

{% block body %}
    {% for message in app.flashes('notice') %}
        <div class="flash-notice">
            {{ message }}
        </div>
    {% endfor %}

{#    <table class="table">#}
{#        <tbody>#}
{#            <tr>#}
{#                <th>Id</th>#}
{#                <td>{{ product.id }}</td>#}
{#            </tr>#}
{#            <tr>#}
{#                <th>Name</th>#}
{#                <td>{{ product.name }}</td>#}
{#            </tr>#}
{#            <tr>#}
{#                <th>Price</th>#}
{#                <td>{{ product.price }}</td>#}
{#            </tr>#}
{#            <tr>#}
{#                <th>CreatedAt</th>#}
{#                <td>{{ product.createdAt ? product.createdAt|date('Y-m-d H:i:s') : '' }}</td>#}
{#            </tr>#}
{#            <tr>#}
{#                <th>UpdatedAt</th>#}
{#                <td>{{ product.updatedAt ? product.updatedAt|date('Y-m-d H:i:s') : '' }}</td>#}
{#            </tr>#}
{#        </tbody>#}
{#    </table>#}

{#    {% for productoption in product.productoptions %}#}
{#    <p>#}
{#        {{ productoption.name }}#}
{#    </p>#}
{#    {% endfor %}#}

    <a href="{{ path('product_index') }}">back to list</a>

{#    <a href="{{ path('product_edit', {'id': product.id}) }}">edit</a>#}

{#    {{ include('product/_delete_form.html.twig') }}#}

    <div class="product-container">

        <h1>{{ product.name }}</h1>
        &euro; <span class="price">{{ product.price|number_format(2, ',', '.') }}</span> p/s


    {{ form_start(form, {'attr':{'data-price':product.price} }) }}
    {{ form_widget(form) }}
    <button class="btn">{{ button_label|default('In Winkelwagen') }}</button>
    {{ form_end(form) }}
    </div>

{% endblock %}

{% block javascripts %}
{#    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>#}
    {{ parent() }}
    <script>
        /*
         * number_format functie voor javascript https://gist.github.com/rd13/3924792
         */
        String.prototype.number_format = function(d) {
            var n = this;
            var c = isNaN(d = Math.abs(d)) ? 2 : d;
            var s = n < 0 ? "-" : "";
            var i = parseInt(n = Math.abs(+n || 0).toFixed(c)) + "", j = (j = i.length) > 3 ? j % 3 : 0;
            return s + (j ? i.substr(0, j) + '.' : "") + i.substr(j).replace(/(\d{3})(?=\d)/g, "$1" + '.') + (c ? ',' + Math.abs(n - i).toFixed(c).slice(2) : "");
        }

        $( document ).ready(function() {
            $('.productoption').change(function() {
                var container = $(this).closest('.product-container');
                var form = $(this).closest('form');
                var totalPrice = parseFloat(form.attr('data-price'));

                $(form.find('.productoption')).each(function() {
                    var optionPrice = $(this).find(":selected").attr('data-price');

                    if(typeof optionPrice !== typeof undefined && optionPrice !== false) {
                        totalPrice += parseFloat(optionPrice);
                    }

                });

                container.find('span.price').text(totalPrice.toString());
                // container.find('span.price').text(totalPrice.toString().number_format());
            });
        });
    </script>
{% endblock %}